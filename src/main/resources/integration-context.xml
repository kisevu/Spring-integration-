<?xml version="1.0" encoding="UTF-8" ?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:int="http://www.springframework.org/schema/integration"
       xsi:schemaLocation="http://www.springframework.org/schema/beans
                           http://www.springframework.org/schema/beans/spring-beans.xsd
                           http://www.springframework.org/schema/integration
                           http://www.springframework.org/schema/integration/spring-integration.xsd">

    <int:gateway service-interface="com.ameda.kevin.integration_spring.PrinterGateway"
                 default-request-channel="inputChannel" />
    <int:channel id="inputChannel" />
    <int:channel id="outputChannel" />
    <int:channel id="filterChannel" />
    <int:channel id="enricherChannel" />
    <int:channel id="requestChannel" />


    <int:service-activator ref="customService" input-channel="requestChannel" method="getPhoneNumber"/>
    <int:enricher input-channel="inputChannel" request-channel="requestChannel" output-channel="enricherChannel">
        <int:property name="phoneNumber" expression="payload"/>
    </int:enricher>
    <int:header-filter header-names="privateKey" input-channel="enricherChannel" output-channel="filterChannel" />
    <int:object-to-json-transformer input-channel="filterChannel" output-channel="outputChannel"/>

    <bean id="customService" class="com.ameda.kevin.integration_spring.CustomService"/>
   <bean id="printService" class="com.ameda.kevin.integration_spring.PrintService" />

   <int:service-activator ref="printService" method="print" input-channel="outputChannel"/>
</beans>

<!--
* Payload  Enricher
**************************
* used to append additional info to a message's payload.
* Allows us to pass a message to a request channel which returns a message that we can use to append additional message
to our current message.
* on the Person we've added the phoneNumber field and updated the accessor to it.
* We'll be using payload enricher to populate the phone number there.
* In the above the message is dropped to the inputChannel, delivers to enricher, enricher to requestChannel,
service activator associated with CustomerService and get back message containing the string phone number as the payload.
we instruct the spring integration to take the string phone number payload and assign it to the phoneNumber field of the
Person entity. After enriching the payload is then put into the outputChannel and goes to PrintService which later gets
printed onto the console.
-->
